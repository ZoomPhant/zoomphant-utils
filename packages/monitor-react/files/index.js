var k=function(o,r){return r.reduce((n,M)=>{return n[M]=o[M],n},{})},l=function(){const{userAgent:o}=window.navigator;let r="Unknown";if(/Windows/.test(o))r="Windows";else if(/Mac OS|Macintosh/.test(o))r="macOS";else if(/Linux/.test(o))r="Linux";else if(/Android/.test(o))r="Android";else if(/iOS|iPad|iPhone|iPod/.test(o))r="iOS";return r},q=function(){const{userAgent:o}=window.navigator;let r="Unknown",n="Unknown";if(/Firefox\/([\d.]+)/.test(o))r="Firefox",n=RegExp.$1;else if(/Chrome\/([\d.]+)/.test(o))r="Chrome",n=RegExp.$1;else if(/Safari\/([\d.]+)/.test(o))r="Safari",n=RegExp.$1;else if(/MSIE (\d+\.\d+);/.test(o))r="Internet Explorer",n=RegExp.$1;else if(/Edge\/([\d.]+)/.test(o))r="Edge",n=RegExp.$1;else if(/Opera\/([\d.]+)/.test(o))r="Opera",n=RegExp.$1;return{name:r,version:n}},b="0.0.3",t=window.fetch,p={...console},x=window.XMLHttpRequest,z=(o)=>{try{return JSON.stringify(o)}catch(r){return String(o)}};class v{static initialize(o){window.console.log=function(...r){o.logs.capture(["console","info",r.join(" ")]),p.log.call(p,...r)},window.console.warn=function(...r){o.logs.capture(["console","warn",r.join(" ")]),p.warn.call(p,...r)},window.console.error=function(...r){o.logs.capture(["console","error",r.join(" ")]),p.error.call(p,...r)}}}class w{static initialize(o){if(!("fetch"in window))return;async function r(...n){const[M,{method:u="GET",body:i}={}]=n;try{const c=await t.apply(this,n),m=["fetch","info",`${u} ${M} [${c.status}]`];if(i)o.logs.capture([...m,{data:i}]);else o.logs.capture(m);return Promise.resolve(c)}catch(c){return Promise.reject(c)}}window.fetch=r}}class R{static initialize(o){const r=x.prototype.open,n=x.prototype.send;x.prototype.open=function(...M){const[u,i,c]=M;return this.memo={method:null,url:null,async:null},this.memo.method=u,this.memo.url=i,this.memo.async=c,r.apply(this,[...M])},x.prototype.send=function(...M){return this.addEventListener("readystatechange",function(){if(this.readyState===4){const u=["xhr","info",`${this.memo.method} ${this.memo.url} [${this.status}]`];if(M.length>0)o.logs.capture([...u,{data:M[0]}]);else o.logs.capture(u)}}),n.apply(this,[...M])}}}class C{type;level;message;timestamp;extra;constructor(o,r,n,M){this.level=r,this.message=n,this.type=o,this.timestamp=(new Date()).getTime(),this.extra=M||{},this.generateExtra()}generateExtra(){this.timestamp=(new Date()).getTime();const{name:o,version:r}=q(),n=this.extra||{};n.url=window.location.href,n.os=l(),n.browser=o,n.browserVersion=r,n.title=document.title,this.extra=n}destroy(){this.message=null,this.type=null,this.timestamp=null,this.extra=null}}class f{list;max;constructor({max:o=1}){this.max=o,this.list=[]}push(o){this.list=[...(this.list||[]).slice(-1*this.max+1),o]}toNormalize(o){if(!this.list||this.list.length<=0)return null;const r=this.list[this.list.length-1];return{...k(r.extra||{},["browser","url","os","title"]),level:r.level,instance:o,stack:(this.list||[]).reduce((n,M)=>{const{message:u,timestamp:i,type:c}=M;return[...n,(Array.isArray(u)?u:[u]).map((m)=>`[${c}] [${i}] ${typeof m==="string"?m.trim():z(m)}`)]},[]).reverse().join("\n")}}stringify(o){return JSON.stringify(this.toNormalize(o))}destroy(){(this.list||[]).forEach((o)=>o.destroy()),this.list=null}}class d{core;maxStacks=10;stacks=[];constructor(o,r){this.core=o,this.maxStacks=r,this.stacks=[new f({max:this.maxStacks})]}capture(o){if(this.core)if(o instanceof C){const[r]=this.stacks;r.push(o)}else{const[r]=this.stacks;if(o.length===4)r.push(new C(...o));else if(o.length===3)r.push(new C(...[...o,{}]));else throw Error("Invalid params")}}captureAndSync(o){if(this.core){this.capture(o),this.stacks.unshift(new f({max:this.maxStacks}));let r=this.stacks.pop();if(r)return this.core.post({type:"logs",body:r.stringify(this.core.baseSettings.instanceId)}).finally(()=>{if(r)r.destroy(),r=void 0})}return Promise.resolve()}}class P{static version=b;connectorId="zoomphant-connector";monitorId="zoomphant-monitor";baseSettings=null;pluginSettings={xhr:!1,fetch:!1,console:!1};connector=null;messageResolvers={};logs;constructor(o){if(new.target!==P)throw new Error("A static class cannot be instantiated.");if(!o)throw new Error("Settings is required");if(this.baseSettings={account:o.account,agent:o.agent,token:o.token,domain:o.domain,instanceId:o.instanceId},this.logs=new d(this,o.maxStacks||10),o.plugins){if(o.plugins.xhr)this.pluginSettings.xhr=!0;if(o.plugins.fetch)this.pluginSettings.fetch=!0;if(o.plugins.console)this.pluginSettings.console=!0}this.initialize()}initialize(){if(this.createConnector(),this.addEventListeners(),this.pluginSettings.fetch)w.initialize(this);if(this.pluginSettings.xhr)R.initialize(this);if(this.pluginSettings.console)v.initialize(this)}createConnector(){this.connector=document.getElementById(this.connectorId)??document.createElement("iframe"),this.connector.id=this.connectorId,this.connector.src=`${this.baseSettings.domain}/connector.html?${new URLSearchParams({...this.baseSettings||{},domain:window.location.origin})}`,this.connector.style.position="absolute",this.connector.style.width="0",this.connector.style.height="0",this.connector.style.border="none",this.connector.style.marginLeft="-999px",document.body.appendChild(this.connector)}addEventListeners(){window.addEventListener("message",this.handleMessage.bind(this))}handleMessage(o){const{source:r,body:n,messageId:M}=o.data;if(r===this.connectorId){const u=this.messageResolvers[M];if(u)u(n),delete this.messageResolvers[M]}}post({type:o,body:r}){if(!this.connector)throw new Error("Connector not found");const n=crypto.randomUUID(),M=new Promise((u)=>{this.messageResolvers[n]=u});return this.connector.contentWindow?.postMessage({source:this.monitorId,type:o,body:r,messageId:n},this.baseSettings.domain),M}destroy(){if(this.connector)document.body.removeChild(this.connector),this.connector=null}}var A=P,h=A;import E,{useEffect as G} from"react";import{jsxDEV as H} from"react/jsx-dev-runtime";var F,W=E.createContext(null),L=({monitor:o,children:r})=>{return G(()=>{F=o},[]),H(W.Provider,{value:o,children:r},void 0,!1,void 0,this)},N=()=>{const o=E.useContext(W);if(!o)throw new Error("useMonitor must be used within a MonitorProvider");return o},O=()=>F;var Z=h;export{N as useMonitor,O as getMonitor,Z as default,L as MonitorProvider};

//# debugId=E61D954DA9FA94E864756e2164756e21
